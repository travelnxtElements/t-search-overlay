<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../iron-dropdown/iron-dropdown-scroll-manager.html">
 
<!--
`t-search-overlay` is an interstetial or a wait page. Ideally while loading a long list of results.
Theres a progress bar which runs with the value of timer. You can set the value to 100 to take the progress to 100 and hide the overlay.  
There are two contents,  you can pass .data and .footer
Example:
	<t-search-overlay>
		<div class="data">
			<t-flight-header hide-modal></t-flight-header>
		</div>
		<div class="footer">
			<img src="http://dev-capi.tavisca.com/NewUI/eva/Air/images/main-logo.png" alt="">
		</div>
	</t-search-overlay>
### Styling
  
  * {
    /* The background. */
    --app-header-bg, #0e5398

    /* Search overlay progress*/
    --search-overlay-progress:#5d9cec
  }
-->
<dom-module id="t-search-overlay">
    <template>
    <style >
        :host([hide]) {
            -ms-transform: scale(0);
            /* IE 9 */
            -webkit-transform: scale(0);
            /* Safari */
            transition: 1s ease all;
            transform: scale(0);
        }
        
        :host {
            display: block;
            text-align: center;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            font-family: var(--header-font-family, --primary-font-family);
            color: var(--light-color, #fff);
            background: var(--app-header-bg, #0e5398);
            z-index: 9;
        }
        
        .overlay {
            height: 100%;
        }
        
        iron-icon {
            width: 100px;
            height: 100px;
            color:  var(--light-color, #fff);
            border-radius: 50%;
            padding: 10px;
        }
        .content-area {
            margin-top: 15px;
        }
        
        .content-area::content .heading {
            margin-bottom: 10px;
        }
        .content-area::content .places {
            display: block;
        }
        .progress {
            margin: 0;
            padding: 2px;
            height: 26px;
            border: 3px solid #ffffff;
            border-radius: 12px;
            background: transparent;
            box-shadow: none;
            width: 90vw;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        .progressText{
            font-size: 11px;
            line-height: 16px;
            position: absolute;
            left: 50%;
            transform:translateX(-50%);
        }
        #progressBar {
            height: 16px;
            border-radius: 12px;
            background: var(--search-overlay-progress,#5d9cec);
            box-shadow: none;
            vertical-align: middle;
            transition: 0.3s ease width;
        }
        
        .loading-btm-text {
            font-size: 12px;
            line-height: 16px;
            font-weight: 300;
            color: #5d9cec;
            text-align: center;
            margin-top: 5px;
        }
        
        .footer-area {
            padding: 15px 0 30px;
        }
        
        .footer-area::content img {
            width: 120px;
        }
        </style>
        <div class="layout vertical overlay">
            <div class="flex horizontal layout center center-justified">
                <div class="layout vertical ">
                    <div id="animated-example" class="animated pulse">
                        <iron-icon icon="{{icon}}"></iron-icon>
                    </div>
                    <div class="content-area">
                        <content select=".data"></content>
                    </div>
                    <div class="progress">
                        <span class="progressText"><span>{{value}}</span>%</span>
                        <div id="progressBar">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layout horizontal center center-justified footer-area">
                <content select=".footer"></content>
            </div>
        </div>
    </template>
</dom-module>
<script>
Polymer({

    is: 't-search-overlay',

    properties: {



      /**
       * Put the icon you want to use as overlay.
       */
        icon: {
            type: String,
            reflectToAttribute: true,
            value: 'maps:flight'
        },


      /**
       * Set to 100 to close the icon.
       */
        value: {
            type: Number,
            reflectToAttribute: true,
            value: 0,
            observer: '_progressAnimation'
        },


      /**
       * This is a boolean Which hides the icon when set to true.
       * Note: Seting hide to true wont make the value 100
       */
        hide: {
            type: Boolean,
            reflectToAttribute: true,
            value: false
        },

	  /**
		* Change the speed of the timer in milliseconds. 
		* Increasing this will move the timer slower
		*
		*/
		timer: {
			type:Number,
			value:500
		}

    },

    ready: function() {
        this._progressAuto();
    },
    
    _progressAnimation: function() {
        this.$.progressBar.style.width = this.value + '%';
        var component = this;
        if (this.value == 100) {
            Polymer.IronDropdownScrollManager.removeScrollLock(component);
            setTimeout(
                function() {
                    component.hide = true
                }, 300);
        }
    },

    _progressAuto: function() {
        Polymer.IronDropdownScrollManager.pushScrollLock(this);
        var component = this;
        for (a = 0; a < 90; a++) {
            setTimeout(
                function() {
                    if (component.value < 90) {
                        component.value = component.value +1;
                    }
                }, a * component.timer);
        }
    }
});
</script>
